<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game T·∫≠p G√µ Ch·ªØ: T·ª´ V·ª±ng</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #1a1a2e;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            flex-direction: column;
            text-align: center;
        }

        .game-container {
            position: relative;
            width: 90%;
            max-width: 800px;
            height: 600px;
            border: 5px solid #00bfff;
            background-color: #2e2e4a;
            box-shadow: 0 0 20px rgba(0, 191, 255, 0.5);
            overflow: hidden;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .falling-char {
            position: absolute;
            top: -50px;
            font-size: 3em;
            font-weight: bold;
            color: #ffcc00;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
            user-select: none;
            will-change: transform, top, left;
            animation: bounce 1.5s infinite;
        }

        .correct-char-display {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2.5em;
            color: #32cd32;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
            letter-spacing: 5px;
            opacity: 1;
            transition: opacity 0.5s ease-in-out;
        }
        
        .word-info {
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0.8;
            transition: opacity 0.5s ease-in-out;
        }

        .word-info .emoji {
            font-size: 5em;
            margin-bottom: 10px;
        }

        .word-info .vietnamese {
            font-size: 1.5em;
            font-weight: bold;
            color: #fff;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }

        .game-info {
            display: flex;
            justify-content: space-around;
            width: 100%;
            max-width: 800px;
            margin-top: 20px;
        }

        .controls {
            margin-top: 20px;
            display: flex;
            gap: 20px;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-start {
            background-image: linear-gradient(to right, #00bfff, #0073e6);
            color: white;
        }

        .btn-reset {
            background-image: linear-gradient(to right, #ff416c, #ff4b2b);
            color: white;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        #score-display {
            font-size: 2em;
            font-weight: bold;
            color: #f7b731;
            margin-top: 20px;
        }
        
        .main-menu {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
        }

        .firework {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #fff;
            border-radius: 50%;
            opacity: 0;
            animation: firework-burst 1s forwards;
            z-index: 100;
        }
        
        #end-game-message {
            font-size: 2.5em;
            font-weight: bold;
            color: #fff;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
            animation: bounce 2s infinite;
        }

        @keyframes firework-burst {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(2.5);
                opacity: 0;
            }
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        /* Th√™m c√°c ƒëi·ªÅu ch·ªânh cho c√°c thi·∫øt b·ªã nh·ªè h∆°n */
        @media (max-width: 768px) {
            .game-container {
                height: 50vh;
            }
            .word-info .emoji {
                font-size: 3em;
            }
            .word-info .vietnamese {
                font-size: 1.2em;
            }
            .falling-char {
                font-size: 2em;
            }
            .correct-char-display {
                font-size: 1.5em;
            }
            .btn {
                padding: 10px 20px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>

    <div class="game-container">
        <!-- Menu ch√≠nh s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã khi game kh√¥ng ch·∫°y -->
        <div id="main-menu" class="main-menu">
            <h1>Game G√µ T·ª´ V·ª±ng</h1>
            <p>B·∫•m B·∫Øt ƒë·∫ßu ƒë·ªÉ ch∆°i</p>
        </div>
        <!-- Th√¥ng b√°o k·∫øt th√∫c game -->
        <div id="end-game-message" style="display: none;">
            Ch√∫c m·ª´ng! B·∫°n ƒë√£ ho√†n th√†nh t·∫•t c·∫£ c√°c t·ª´!
        </div>
        
        <!-- Hi·ªÉn th·ªã emoji v√† nghƒ©a ti·∫øng Vi·ªát -->
        <div id="word-info" class="word-info">
            <span id="word-emoji" class="emoji"></span>
            <span id="word-vietnamese" class="vietnamese"></span>
        </div>
        
        <!-- Ch·ªØ r∆°i s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y b·∫±ng JS -->
        <div id="correct-char-display" class="correct-char-display"></div>
    </div>

    <div class="game-info">
        <h2 id="current-word">S·∫µn s√†ng!</h2>
        <h2 id="score-display">T·ª´ ho√†n th√†nh: 0</h2>
    </div>

    <div class="controls">
        <button id="start-btn" class="btn btn-start">B·∫Øt ƒë·∫ßu</button>
        <button id="reset-btn" class="btn btn-reset">Ch∆°i l·∫°i</button>
    </div>
    
    <!-- Input ·∫©n ƒë·ªÉ k√≠ch ho·∫°t b√†n ph√≠m ·∫£o tr√™n di ƒë·ªông -->
    <input type="text" id="hidden-input" style="position: absolute; opacity: 0; pointer-events: none;">

    <script>
        // Danh s√°ch c√°c t·ª´ v·ª±ng v·ªõi nghƒ©a ti·∫øng Vi·ªát v√† emoji
        const words = [
            { english: "alligator", vietnamese: "c√° s·∫•u", emoji: "üêä" },
            { english: "ant", vietnamese: "con ki·∫øn", emoji: "üêú" },
            { english: "apple", vietnamese: "qu·∫£ t√°o", emoji: "üçé" },
            { english: "ball", vietnamese: "qu·∫£ b√≥ng", emoji: "‚öΩ" },
            { english: "banana", vietnamese: "qu·∫£ chu·ªëi", emoji: "üçå" },
            { english: "bear", vietnamese: "con g·∫•u", emoji: "üêª" },
            { english: "car", vietnamese: "√¥ t√¥", emoji: "üöó" },
            { english: "cat", vietnamese: "con m√®o", emoji: "üêà" },
            { english: "cow", vietnamese: "con b√≤", emoji: "üêÑ" },
            { english: "dog", vietnamese: "con ch√≥", emoji: "üêï" },
            { english: "drum", vietnamese: "tr·ªëng", emoji: "ü•Å" },
            { english: "duck", vietnamese: "con v·ªãt", emoji: "ü¶Ü" },
            { english: "ear", vietnamese: "c√°i tai", emoji: "üëÇ" },
            { english: "egg", vietnamese: "qu·∫£ tr·ª©ng", emoji: "ü•ö" },
            { english: "elephant", vietnamese: "con voi", emoji: "üêò" },
            { english: "fish", vietnamese: "con c√°", emoji: "üêü" },
            { english: "frog", vietnamese: "con ·∫øch", emoji: "üê∏" },
            { english: "gift", vietnamese: "qu√† t·∫∑ng", emoji: "üéÅ" },
            { english: "goat", vietnamese: "con d√™", emoji: "üêê" },
            { english: "bunch of grapes", vietnamese: "ch√πm nho", emoji: "üçá" },
            { english: "hat", vietnamese: "c√°i m≈©", emoji: "üé©" },
            { english: "horse", vietnamese: "con ng·ª±a", emoji: "üêé" },
            { english: "house", vietnamese: "ng√¥i nh√†", emoji: "üè†" },
            { english: "ice cream", vietnamese: "kem", emoji: "üç¶" },
            { english: "insect", vietnamese: "c√¥n tr√πng", emoji: "üêõ" },
            { english: "kangaroo", vietnamese: "chu·ªôt t√∫i", emoji: "ü¶ò" },
            { english: "key", vietnamese: "ch√¨a kh√≥a", emoji: "üîë" },
            { english: "kite", vietnamese: "c√°nh di·ªÅu", emoji: "ü™Å" },
            { english: "leaf", vietnamese: "c√°i l√°", emoji: "üçÉ" },
            { english: "lion", vietnamese: "con s∆∞ t·ª≠", emoji: "ü¶Å" },
            { english: "milk", vietnamese: "s·ªØa", emoji: "ü•õ" },
            { english: "moon", vietnamese: "m·∫∑t trƒÉng", emoji: "üåï" },
            { english: "monkey", vietnamese: "con kh·ªâ", emoji: "üêí" },
            { english: "net", vietnamese: "c√°i l∆∞·ªõi", emoji: "ü•Ö" },
            { english: "nose", vietnamese: "c√°i m≈©i", emoji: "üëÉ" },
            { english: "octopus", vietnamese: "b·∫°ch tu·ªôc", emoji: "üêô" },
            { english: "orange", vietnamese: "qu·∫£ cam", emoji: "üçä" },
            { english: "owl", vietnamese: "c√∫ m√®o", emoji: "ü¶â" },
            { english: "pen", vietnamese: "c√¢y b√∫t", emoji: "üñãÔ∏è" },
            { english: "pig", vietnamese: "con l·ª£n", emoji: "üê∑" },
            { english: "pizza", vietnamese: "b√°nh pizza", emoji: "üçï" },
            { english: "rabbit", vietnamese: "con th·ªè", emoji: "üêá" },
            { english: "robot", vietnamese: "ng∆∞·ªùi m√°y", emoji: "ü§ñ" },
            { english: "sock", vietnamese: "t·∫•t", emoji: "üß¶" },
            { english: "star", vietnamese: "ng√¥i sao", emoji: "‚≠ê" },
            { english: "sun", vietnamese: "m·∫∑t tr·ªùi", emoji: "‚òÄÔ∏è" },
            { english: "tiger", vietnamese: "h·ªï", emoji: "üêÖ" },
            { english: "turtle", vietnamese: "r√πa", emoji: "üê¢" },
            { english: "umbrella", vietnamese: "c√°i √¥", emoji: "‚òÇÔ∏è" },
            { english: "unicorn", vietnamese: "k√¨ l√¢n", emoji: "ü¶Ñ" },
            { english: "uniform", vietnamese: "ƒë·ªìng ph·ª•c", emoji: "üëï" },
            { english: "van", vietnamese: "xe van", emoji: "üöê" },
            { english: "violin", vietnamese: "ƒë√†n violin", emoji: "üéª" },
            { english: "watch", vietnamese: "ƒë·ªìng h·ªì ƒëeo tay", emoji: "‚åö" },
            { english: "whale", vietnamese: "c√° voi", emoji: "üê≥" },
            { english: "yo-yo", vietnamese: "ƒë·ªì ch∆°i yoyo", emoji: "ü™Ä" },
            { english: "zebra", vietnamese: "ng·ª±a v·∫±n", emoji: "ü¶ì" }
        ];

        // L·∫•y c√°c ph·∫ßn t·ª≠ DOM c·∫ßn thi·∫øt
        const gameContainer = document.querySelector('.game-container');
        const startBtn = document.getElementById('start-btn');
        const resetBtn = document.getElementById('reset-btn');
        const scoreDisplay = document.getElementById('score-display');
        const currentWordDisplay = document.getElementById('current-word');
        const correctCharDisplay = document.getElementById('correct-char-display');
        const mainMenu = document.getElementById('main-menu');
        const endGameMessage = document.getElementById('end-game-message');
        const wordInfo = document.getElementById('word-info');
        const wordEmoji = document.getElementById('word-emoji');
        const wordVietnamese = document.getElementById('word-vietnamese');
        const hiddenInput = document.getElementById('hidden-input');
        
        // C√°c bi·∫øn tr·∫°ng th√°i c·ªßa game
        let currentWordChars = [];
        let wordIndex = 0;
        let score = 0;
        let fallingChars = [];
        let isGameRunning = false;
        let fireworkCount = 0;
        let animationFrames = [];
        let currentWordDataIndex = 0;
        let nextWordTimeoutId = null;

        /**
         * T·∫°o m·ªôt ch·ªØ c√°i r∆°i t·ª´ tr√™n xu·ªëng, di chuy·ªÉn ngang theo th·ª© t·ª±.
         * @param {string} char - K√Ω t·ª± s·∫Ω ƒë∆∞·ª£c t·∫°o.
         * @param {number} charIndex - V·ªã tr√≠ c·ªßa k√Ω t·ª± trong t·ª´.
         * @param {number} totalChars - T·ªïng s·ªë k√Ω t·ª± trong t·ª´.
         */
        function createFallingChar(char, charIndex, totalChars) {
            const charElement = document.createElement('div');
            charElement.classList.add('falling-char');
            charElement.textContent = char;
            gameContainer.appendChild(charElement);

            const fallingDuration = 8000;
            const horizontalRange = gameContainer.offsetWidth - 50;
            const horizontalStep = horizontalRange / totalChars;
            const startX = horizontalStep * charIndex;
            const startTime = performance.now();

            function animateChar(currentTime) {
                if (!isGameRunning && charElement.parentElement) {
                    charElement.remove();
                    return;
                }
                
                const elapsedTime = currentTime - startTime;
                const progress = elapsedTime / fallingDuration;

                if (progress >= 1) {
                    if (charElement.parentElement) {
                        charElement.remove();
                        endWord();
                        return;
                    }
                }
                
                charElement.style.top = `${progress * gameContainer.offsetHeight}px`;
                charElement.style.left = `${startX + (progress * 10)}px`;
                
                animationFrames.push(requestAnimationFrame(animateChar));
            }

            animationFrames.push(requestAnimationFrame(animateChar));
            fallingChars.push({ element: charElement, char: char });
        }

        /**
         * S·ª≠ d·ª•ng Web Speech API ƒë·ªÉ ƒë·ªçc t·ª´.
         * @param {string} text - VƒÉn b·∫£n c·∫ßn ƒë·ªçc.
         */
        function playWordAudio(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            speechSynthesis.speak(utterance);
        }

        /**
         * B·∫Øt ƒë·∫ßu tr√≤ ch∆°i.
         */
        function startGame() {
            if (isGameRunning) return;
            isGameRunning = true;
            mainMenu.style.display = 'none';
            endGameMessage.style.display = 'none';
            score = 0;
            currentWordDataIndex = 0;
            updateScoreDisplay();
            startNewWord();
            document.addEventListener('keydown', handleKeyPress);
            startBtn.style.display = 'none';
            resetBtn.style.display = 'block';

            // T·ª± ƒë·ªông t·∫≠p trung v√†o input ·∫©n ƒë·ªÉ k√≠ch ho·∫°t b√†n ph√≠m ·∫£o
            hiddenInput.focus();
        }

        /**
         * B·∫Øt ƒë·∫ßu m·ªôt t·ª´ m·ªõi.
         */
        function startNewWord() {
            if (!isGameRunning) {
                return;
            }
            
            wordIndex = 0;
            
            if (currentWordDataIndex >= words.length) {
                endGame();
                return;
            }
            
            const currentWordData = words[currentWordDataIndex];
            currentWordChars = currentWordData.english.split('');

            currentWordDisplay.textContent = currentWordData.english;
            wordEmoji.textContent = currentWordData.emoji;
            wordVietnamese.textContent = currentWordData.vietnamese;
            wordInfo.style.opacity = 1;

            correctCharDisplay.textContent = '';
            
            cancelAnimations();
            gameContainer.querySelectorAll('.falling-char').forEach(char => char.remove());
            fallingChars = [];

            // ƒê·ªçc t·ª´ khi b·∫Øt ƒë·∫ßu
            playWordAudio(currentWordDisplay.textContent);
            
            let delay = 0;
            const totalChars = currentWordChars.filter(char => char !== ' ').length;
            let fallingCharCount = 0;

            currentWordChars.forEach(char => {
                if (char !== ' ') {
                    setTimeout(() => {
                        createFallingChar(char.toUpperCase(), fallingCharCount, totalChars);
                        fallingCharCount++;
                    }, delay);
                    delay += 300;
                }
            });
        }

        /**
         * K·∫øt th√∫c t·ª´ hi·ªán t·∫°i n·∫øu ng∆∞·ªùi ch∆°i b·ªè l·ª° m·ªôt ch·ªØ.
         */
        function endWord() {
            if(!isGameRunning) {
                return;
            }

            isGameRunning = false;
            
            cancelAnimations();
            fallingChars.forEach(c => c.element.remove());
            fallingChars = [];
            
            nextWordTimeoutId = setTimeout(() => {
                isGameRunning = true;
                startNewWord();
            }, 2000);
        }

        /**
         * X·ª≠ l√Ω s·ª± ki·ªán khi ng∆∞·ªùi ch∆°i b·∫•m ph√≠m.
         * @param {KeyboardEvent} e - S·ª± ki·ªán b√†n ph√≠m.
         */
        function handleKeyPress(e) {
            if (!isGameRunning || wordIndex >= currentWordChars.length) {
                return;
            }
            // ƒê·∫£m b·∫£o ch·ªâ x·ª≠ l√Ω input t·ª´ b√†n ph√≠m ch·ªØ c√°i
            if (e.key.length !== 1) {
                return;
            }

            while (currentWordChars[wordIndex] === ' ' && wordIndex < currentWordChars.length) {
                correctCharDisplay.textContent += ' ';
                wordIndex++;
            }

            if (wordIndex >= currentWordChars.length) {
                completeWord();
                return;
            }

            const keyPressed = e.key.toUpperCase();
            const targetChar = currentWordChars[wordIndex].toUpperCase();

            if (keyPressed === targetChar) {
                const charToFindIndex = fallingChars.findIndex(c => c.char.toUpperCase() === targetChar);
                
                if (charToFindIndex !== -1) {
                    const charToFind = fallingChars[charToFindIndex];
                    charToFind.element.remove();
                    fallingChars.splice(charToFindIndex, 1);
                    
                    correctCharDisplay.textContent += currentWordChars[wordIndex];
                    wordIndex++;
                    
                    while (currentWordChars[wordIndex] === ' ' && wordIndex < currentWordChars.length) {
                        correctCharDisplay.textContent += ' ';
                        wordIndex++;
                    }

                    if (wordIndex >= currentWordChars.length) {
                        completeWord();
                    }
                }
            }
        }

        /**
         * X·ª≠ l√Ω khi ng∆∞·ªùi ch∆°i ho√†n th√†nh m·ªôt t·ª´.
         */
        function completeWord() {
            score++;
            currentWordDataIndex++;
            updateScoreDisplay();
            playFireworks();
            
            isGameRunning = false;
            
            const currentWordData = words[currentWordDataIndex - 1]; // L·∫•y t·ª´ v·ª´a ho√†n th√†nh
            playWordAudio(currentWordData.english); // ƒê·ªçc l·∫°i t·ª´ ƒë√≥

            nextWordTimeoutId = setTimeout(() => {
                isGameRunning = true;
                startNewWord();
            }, 4000);
        }
        
        /**
         * X·ª≠ l√Ω khi ng∆∞·ªùi ch∆°i ho√†n th√†nh t·∫•t c·∫£ c√°c t·ª´.
         */
        function endGame() {
            isGameRunning = false;
            currentWordDisplay.textContent = 'Tr√≤ ch∆°i k·∫øt th√∫c!';
            correctCharDisplay.textContent = '';
            wordInfo.style.opacity = 0;
            playFireworks();
            endGameMessage.style.display = 'block';

            // X√≥a focus kh·ªèi input ·∫©n
            hiddenInput.blur();
        }

        /**
         * C·∫≠p nh·∫≠t s·ªë t·ª´ ho√†n th√†nh tr√™n m√†n h√¨nh.
         */
        function updateScoreDisplay() {
            scoreDisplay.textContent = `T·ª´ ho√†n th√†nh: ${score}`;
        }
        
        /**
         * B·∫Øt ƒë·∫ßu hi·ªáu ·ª©ng ph√°o hoa.
         */
        function playFireworks() {
            fireworkCount = 0;
            triggerFireworkBurst();
        }

        /**
         * K√≠ch ho·∫°t m·ªôt ƒë·ª£t ph√°o hoa.
         */
        function triggerFireworkBurst() {
            if (fireworkCount >= 3) return;
            fireworkCount++;
            for (let i = 0; i < 50; i++) {
                createFirework();
            }
            setTimeout(triggerFireworkBurst, 1000);
        }

        /**
         * T·∫°o m·ªôt h·∫°t ph√°o hoa ƒë∆°n l·∫ª.
         */
        function createFirework() {
            const firework = document.createElement('div');
            firework.classList.add('firework');
            const x = Math.random() * gameContainer.offsetWidth;
            const y = Math.random() * gameContainer.offsetHeight;
            firework.style.left = `${x}px`;
            firework.style.top = `${y}px`;
            gameContainer.appendChild(firework);

            const size = Math.random() * 10 + 5;
            firework.style.width = `${size}px`;
            firework.style.height = `${size}px`;
            firework.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
            
            firework.animate([
                { transform: 'scale(0)', opacity: 1 },
                { transform: 'scale(1.5)', opacity: 0 }
            ], {
                duration: 1000,
                easing: 'ease-out'
            }).onfinish = () => firework.remove();
        }

        /**
         * H·ªßy t·∫•t c·∫£ c√°c animation frame ƒëang ch·∫°y
         */
        function cancelAnimations() {
            animationFrames.forEach(frame => cancelAnimationFrame(frame));
            animationFrames = [];
        }

        /**
         * ƒê·∫∑t l·∫°i tr√≤ ch∆°i v·ªÅ tr·∫°ng th√°i ban ƒë·∫ßu.
         */
        function resetGame() {
            isGameRunning = false;
            score = 0;
            updateScoreDisplay();
            currentWordDisplay.textContent = 'S·∫µn s√†ng!';
            correctCharDisplay.textContent = '';
            wordInfo.style.opacity = 0;
            
            if (nextWordTimeoutId) {
                clearTimeout(nextWordTimeoutId);
            }

            mainMenu.style.display = 'flex';
            endGameMessage.style.display = 'none';
            startBtn.style.display = 'block';
            resetBtn.style.display = 'none';
            
            cancelAnimations();
            gameContainer.querySelectorAll('.falling-char').forEach(char => char.remove());
            fallingChars = [];
            
            document.removeEventListener('keydown', handleKeyPress);
            speechSynthesis.cancel();
            
            document.querySelectorAll('.firework').forEach(fw => fw.remove());

            // X√≥a focus kh·ªèi input ·∫©n
            hiddenInput.blur();
        }
        
        // C·ªë g·∫Øng gi·ªØ b√†n ph√≠m ·∫£o lu√¥n b·∫≠t b·∫±ng c√°ch t·ª± ƒë·ªông l·∫•y l·∫°i focus
        hiddenInput.addEventListener('blur', () => {
            if (isGameRunning) {
                hiddenInput.focus();
            }
        });

        // G·∫Øn s·ª± ki·ªán click cho c√°c n√∫t
        startBtn.addEventListener('click', startGame);
        resetBtn.addEventListener('click', resetGame);

        // Kh·ªüi t·∫°o game khi load trang
        resetGame();
    </script>
</body>
</html>
